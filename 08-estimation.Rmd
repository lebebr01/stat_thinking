---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Estimation / Bootstrap / Uncertainty   

```{r chap-setup, message = FALSE, warning = FALSE}
library(tidyverse)
library(ggformula)
library(mosaic)
library(rsample)
library(statthink)

# Set theme for plots
theme_set(theme_statthinking())

us_weather <- mutate(us_weather, snow_factor = factor(snow), 
                     snow_numeric = ifelse(snow == 'Yes', 1, 0))
```


Bootstrap and resampling methods can be used to estimate the variability in the estimated effects. This is needed as it is most common to have a subset of the entire population rather than the entire population, therefore the model estimates are approximations of the true population parameters. If another sample of data were obtained, the model estimates would be different from the previous sample. This would occur due to different individuals comprised within the sample. The goal of a good sample is to be able to get good estimates of the population parameters of interest. This happens when the sample obtained is as representative as possible of the population, most notably this can be gathered by collected the sample from a random 

## Estimating Error
To get some sense of the amount of error in the estimate of the linear slope, a bootstrap can be done to provide some evidence of the likely range of slope values. The bootstrap will take the following general steps:

1. Resample the observed data available, with replacement
2. Fit the same linear regression model as above.
3. Save the slope coefficient representing the relationship between birth weight and gestational days
4. Repeat steps 1 - 3 many times
5. Explore the distribution of slope estimates from the many resampled data sets.

When this was done with the classification tree, a function was used to do these steps once, then these were repeated many times. Below is a function that does the steps 1 - 3 above a single time.

```{r resample-weather-once}
resample_weather <- function(...) {
  weather_resample <- us_weather %>%
    sample_n(nrow(us_weather), replace = TRUE)

  weather_resample %>%
    lm(drybulbtemp_min ~ dewpoint_avg, data = .) %>%
    coef(.) %>%
    .[2] %>%
    data.frame()
}

resample_weather()
```

Now that there is a function that does steps 1 - 3, these processes can now be repeated many times.

```{r resample-10k-density, fig.cap = ""}
weather_coef <- map_dfr(1:10000, resample_weather)
names(weather_coef) <- 'slope'

gf_density(~ slope, data = weather_coef) %>%
  gf_labs(x = "Linear Slope Estimates")
```

```{r quantile-resample}
weather_coef %>%
  df_stats(~ slope, quantile(c(0.05, 0.5, 0.95)))
```


